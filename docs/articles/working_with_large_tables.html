<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with large tables â€¢ cansim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Working with large tables">
<meta property="og:description" content="Very large StatCan tables can pose challenges for memory footprint and performace. We show how to overcome these challenges by accessing the data through an SQLite database connection.
">
<meta property="og:image" content="https://mountainmath.github.io/cansim/logo.png">
<meta property="og:image:alt" content="cansim">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:site" content="https://mountainmath.github.io/cansim/">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107390160-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107390160-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cansim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cansim.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/listing_cansim_tables.html">Listing Statistics Canada data tables</a>
    </li>
    <li>
      <a href="../articles/retrieving_cansim_vectors.html">Retrieving individual Statistics Canada vectors</a>
    </li>
    <li>
      <a href="../articles/working_with_hierarchies.html">Working with Statistics Canada data table object hierarchies</a>
    </li>
    <li>
      <a href="../articles/working_with_large_tables.html">Working with large tables</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/v0.3.8">Version 0.3.8</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/v0.3.7">Version 0.3.7</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.3.6">Version 0.3.6</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.3.5">Version 0.3.5</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.3.4">Version 0.3.4</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.3.2">Version 0.3.2</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.3.1">Version 0.3.1</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.3">Version 0.3</a>
    </li>
    <li>
      <a href="https://github.com/mountainMath/cansim/releases/tag/0.2.2">Version 0.2.2</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mountainMath/cansim/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="working_with_large_tables_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with large tables</h1>
                        <h4 class="author"></h4>
            
            <h4 class="date">2021-07-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mountainMath/cansim/blob/master/vignettes/working_with_large_tables.Rmd"><code>vignettes/working_with_large_tables.Rmd</code></a></small>
      <div class="hidden name"><code>working_with_large_tables.Rmd</code></div>

    </div>

    
    
<p>Most StatCan tables are small in size and can easily processed in memory. However, some tables are so large that this is not a feasible strategy. Table <code>43-10-0024</code> is one such example and comes with a CSV file that is several gigabytes in size. In cases like this it is more useful to store and access the data as an SQLite database using the <code>get_cansim_sqlite</code> function instead of the usual <code>get_cansim</code>. In these circumstances it is also useful to cache the data for longer than just the current R session, and the <code>data_cache</code> option allows to specify a permanent location. It defaults to <code><a href="https://rdrr.io/r/base/options.html">getOption("cansim.cache_path")</a></code>, and if this option is not set it will only cache the data for the duration of the current session.</p>
<p>For this vignette we use the (rather small) motor vehicle sales data as an example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mountainMath/cansim">cansim</a></span><span class="op">)</span></code></pre></div>
<p>One main difference to the <code>get_cansim</code> method is that <code>get_cansim_sqlite</code> does not return data but only a connection to the database. This allows us to filter the data before fetching the data into memory. When this is called the first time it will fetch the data, parse it into an SQLite database, index the main columns. This can take a significant amount of time, depending on the size of the table. In any subsequent call it will simply open a database connection to the cached database.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cansim_sqlite.html">get_cansim_sqlite</a></span><span class="op">(</span><span class="st">"20-10-0001"</span><span class="op">)</span>
<span class="co">#&gt; Accessing CANSIM NDM product 20-10-0001 from Statistics Canada</span>
<span class="co">#&gt; Parsing data</span>
<span class="co">#&gt; Indexing GEO</span>
<span class="co">#&gt; Indexing Vehicle type</span>
<span class="co">#&gt; Indexing Origin of manufacture</span>
<span class="co">#&gt; Indexing Sales</span>
<span class="co">#&gt; Indexing Seasonal adjustment</span>
<span class="co">#&gt; Indexing REF_DATE</span>
<span class="co">#&gt; Indexing DGUID</span>
<span class="co">#&gt; Indexing GeoUID</span></code></pre></div>
<p>We can inspect the data by looking at the first few columns to get a general idea of what the data looks like.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span>
<span class="co">#&gt; # Source:   lazy query [?? x 19]</span>
<span class="co">#&gt; # Database: sqlite 3.35.5</span>
<span class="co">#&gt; #   [/private/var/folders/m1/ptq5j32n35ngc_qmbyptppn40000gn/T/Rtmp5cP6I4/cansim_20100001_eng/20100001-eng.sqlite]</span>
<span class="co">#&gt;   REF_DATE GEO    DGUID  `Vehicle type`  `Origin of manuâ€¦ Sales `Seasonal adjusâ€¦</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           </span>
<span class="co">#&gt; 1 1946-01  Canada 2016Aâ€¦ Total, new motâ€¦ Total, country â€¦ Units Unadjusted      </span>
<span class="co">#&gt; 2 1946-01  Canada 2016Aâ€¦ Total, new motâ€¦ Total, country â€¦ Dollâ€¦ Unadjusted      </span>
<span class="co">#&gt; 3 1946-01  Canada 2016Aâ€¦ Passenger cars  Total, country â€¦ Units Unadjusted      </span>
<span class="co">#&gt; 4 1946-01  Canada 2016Aâ€¦ Passenger cars  Total, country â€¦ Units Seasonally adjuâ€¦</span>
<span class="co">#&gt; 5 1946-01  Canada 2016Aâ€¦ Passenger cars  Total, country â€¦ Dollâ€¦ Unadjusted      </span>
<span class="co">#&gt; 6 1946-01  Canada 2016Aâ€¦ Trucks          Total, country â€¦ Units Unadjusted      </span>
<span class="co">#&gt; # â€¦ with 12 more variables: UOM &lt;chr&gt;, UOM_ID &lt;chr&gt;, SCALAR_FACTOR &lt;chr&gt;,</span>
<span class="co">#&gt; #   SCALAR_ID &lt;chr&gt;, VECTOR &lt;chr&gt;, COORDINATE &lt;chr&gt;, VALUE &lt;dbl&gt;, STATUS &lt;chr&gt;,</span>
<span class="co">#&gt; #   SYMBOL &lt;chr&gt;, TERMINATED &lt;chr&gt;, DECIMALS &lt;chr&gt;, GeoUID &lt;chr&gt;</span></code></pre></div>
<p>To make good use of the data we will have to look at the metadata and inspect the member columns and variables available. The metadata will be available in the R session after the database connection has been opened. Trying to access the metadata before the connection has been opened will result in the package to attempt to download the data via the <code>get_cansim</code> call, which the <code>get_cansim_sqlite</code> function is trying to avoid.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_cansim_table_overview.html">get_cansim_table_overview</a></span><span class="op">(</span><span class="st">"20-10-0001"</span><span class="op">)</span>
<span class="co">#&gt; New motor vehicle sales</span>
<span class="co">#&gt; CANSIM Table 20-10-0001</span>
<span class="co">#&gt; Start Reference Period: 1946-01-01, End Reference Period: 2021-05-01, Frequency: Monthly</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Column Geography (11)</span>
<span class="co">#&gt; Canada, Newfoundland and Labrador, Prince Edward Island, Nova Scotia, New Brunswick, Quebec, Ontario, Manitoba, Saskatchewan, Alberta, ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Column Vehicle type (3)</span>
<span class="co">#&gt; Total, new motor vehicles, Passenger cars, Trucks</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Column Origin of manufacture (5)</span>
<span class="co">#&gt; Total, country of manufacture, North America, Total, overseas, Japan, Other countries</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Column Sales (2)</span>
<span class="co">#&gt; Units, Dollars</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Column Seasonal adjustment (2)</span>
<span class="co">#&gt; Unadjusted, Seasonally adjusted</span></code></pre></div>
<p>This gives us an understanding of the available variables. For the purpose of this vignette we are interested in the breakdown of sales units by Vehicle type in Canada overall. The data is stored in its raw form in the database, the only processing done is that it is augmented by the GeoUID. In order to work with it we need to <code>collect</code> the data. If the only operation done is filtering, and no selection or renaming of columns was done before accessing the data, we can utilize the custom <code>collect_and_normalize</code> function to collect and at the same time normalize the data so it will appear the same way as if we had used the <code>get_cansim</code> function. This will add the category and hierarchy metadata and the normalized value column.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">connection</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">GEO</span><span class="op">==</span><span class="st">"Canada"</span>,
         <span class="va">`Seasonal adjustment`</span><span class="op">==</span><span class="st">"Unadjusted"</span>,
         <span class="va">Sales</span><span class="op">==</span><span class="st">"Units"</span>,
         <span class="va">`Origin of manufacture`</span><span class="op">==</span><span class="st">"Total, country of manufacture"</span>,
         <span class="va">`Vehicle type`</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Passenger cars"</span>,<span class="st">"Trucks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/collect_and_normalize.html">collect_and_normalize</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 29</span>
<span class="co">#&gt;   REF_DATE GEO    DGUID   UOM   UOM_ID SCALAR_FACTOR SCALAR_ID VECTOR COORDINATE</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;     </span>
<span class="co">#&gt; 1 1946-01  Canada 2016A0â€¦ Units 300    "units "      0         v4216â€¦ 1.2.1.1.1 </span>
<span class="co">#&gt; 2 1946-01  Canada 2016A0â€¦ Units 300    "units "      0         v4216â€¦ 1.3.1.1.1 </span>
<span class="co">#&gt; 3 1946-02  Canada 2016A0â€¦ Units 300    "units "      0         v4216â€¦ 1.2.1.1.1 </span>
<span class="co">#&gt; 4 1946-02  Canada 2016A0â€¦ Units 300    "units "      0         v4216â€¦ 1.3.1.1.1 </span>
<span class="co">#&gt; 5 1946-03  Canada 2016A0â€¦ Units 300    "units "      0         v4216â€¦ 1.2.1.1.1 </span>
<span class="co">#&gt; 6 1946-03  Canada 2016A0â€¦ Units 300    "units "      0         v4216â€¦ 1.3.1.1.1 </span>
<span class="co">#&gt; # â€¦ with 20 more variables: VALUE &lt;dbl&gt;, STATUS &lt;chr&gt;, SYMBOL &lt;chr&gt;,</span>
<span class="co">#&gt; #   TERMINATED &lt;chr&gt;, DECIMALS &lt;chr&gt;, GeoUID &lt;chr&gt;, val_norm &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Date &lt;date&gt;, Classification Code for Vehicle type &lt;chr&gt;,</span>
<span class="co">#&gt; #   Hierarchy for Vehicle type &lt;chr&gt;,</span>
<span class="co">#&gt; #   Classification Code for Origin of manufacture &lt;chr&gt;,</span>
<span class="co">#&gt; #   Hierarchy for Origin of manufacture &lt;chr&gt;,</span>
<span class="co">#&gt; #   Classification Code for Sales &lt;chr&gt;, Hierarchy for Sales &lt;chr&gt;,</span>
<span class="co">#&gt; #   Classification Code for Seasonal adjustment &lt;chr&gt;,</span>
<span class="co">#&gt; #   Hierarchy for Seasonal adjustment &lt;chr&gt;, Vehicle type &lt;fct&gt;,</span>
<span class="co">#&gt; #   Origin of manufacture &lt;fct&gt;, Sales &lt;fct&gt;, Seasonal adjustment &lt;fct&gt;</span></code></pre></div>
<p>Given the data we can further filter the date range and plot it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span><span class="op">&gt;=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1990-01-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Date</span>,y<span class="op">=</span><span class="va">val_norm</span>,color<span class="op">=</span><span class="va">`Vehicle type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>span<span class="op">=</span><span class="fl">0.2</span>,method <span class="op">=</span> <span class="st">'loess'</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">comma</a></span><span class="op">(</span><span class="va">d</span>,scale<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">3</span>,suffix<span class="op">=</span><span class="st">"k"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Canada new motor vehicle sales"</span>,caption<span class="op">=</span><span class="st">"StatCan Table 20-10-0001"</span>,
       x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="st">"Number of units"</span><span class="op">)</span></code></pre></div>
<p><img src="working_with_large_tables_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>When we donâ€™t need the database connection any more we should remember to close it. This frees up resources and keeps the database handlers happy.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/disconnect_cansim_sqlite.html">disconnect_cansim_sqlite</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></code></pre></div>
<div id="keeping-track-of-cached-data" class="section level2">
<h2 class="hasAnchor">
<a href="#keeping-track-of-cached-data" class="anchor"></a>Keeping track of cached data</h2>
<p>Since we now have the option of a more permanent cache we should take care to manage that space properly. The <code>list_cansim_sqlite_cached_tables</code> function gives us an overview over the cached data we have.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/list_cansim_sqlite_cached_tables.html">list_cansim_sqlite_cached_tables</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 8</span>
<span class="co">#&gt;   cansimTableNumber language timeCached          sqliteSize title      path     </span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;    </span>
<span class="co">#&gt; 1 20-10-0001        eng      2021-07-28 13:34:20 44.2 Mb    New motorâ€¦ cansim_2â€¦</span>
<span class="co">#&gt; # â€¦ with 2 more variables: timeReleased &lt;dttm&gt;, upToDate &lt;lgl&gt;</span></code></pre></div>
<p>Cached data wonâ€™t update automatically, we will have to pass the <code>refresh=TRUE</code> option to refresh it manually when we want a fresh data pull from StatCan. If we want to free up disk space we can remove a cached table.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/remove_cansim_sqlite_cached_table.html">remove_cansim_sqlite_cached_table</a></span><span class="op">(</span><span class="st">"20-10-0001"</span><span class="op">)</span>
<span class="co">#&gt; Removing cached data for 20-10-0001 (eng)</span>
<span class="co">#&gt; NULL</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://mountainmath.ca">Jens von Bergmann</a>, <a href="https://dshkol.com">Dmitry Shkolnik</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
